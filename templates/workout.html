<button onclick="openAddWorkoutModal()" class="add-workout-button">Lisa treening</button>

<!-- Filter by Category -->
<div class="filter-container">
    <label for="category-filter">Filtreeri kategooria järgi:</label>
    <select id="category-filter" onchange="filterWorkouts()">
        <option value="all">Kõik</option>
        <option value="jõutreening">Jõutreening</option>
        <option value="kardio">Kardio</option>
        <option value="jooga">Jooga</option>
        <option value="muu">Muu</option>
    </select>
</div>

<!-- Workout Table -->
<table id="workout-table">
    <thead>
        <tr>
            <th>Nimi</th>
            <th>Kategooria</th>
            <th>Kestus (min)</th>
            <th>Meeleolu</th>
            <th>Kes tegi?</th>
            <th>Kuupäev</th>
            <th>Toimingud</th>
        </tr>
    </thead>
    <tbody>
        {% for workout in workouts %}
        <tr class="workout-row" data-category="{{ workout.sport }}">
            <td>{{ workout.name }}</td>
            <td>{{ workout.sport }}</td>
            <td>{{ workout.duration }}</td>
            <td>{{ workout.mood }}</td>
            <td>{{ workout.who_did }}</td>
            <td>{{ workout.date }}</td>
            <td>
                <a href="#" onclick="openEditWorkoutModal('{{ workout.id }}', '{{ workout.name }}', '{{ workout.sport }}', '{{ workout.duration }}', '{{ workout.mood }}', '{{ workout.who_did }}', '{{ workout.date }}'); return false;" class="edit-button">✎</a>
                <a href="{{ url_for('delete_workout', id=workout.id) }}" class="delete-button">❌</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Edit Workout Modal (Hidden Initially) -->
<div id="editWorkoutModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditWorkoutModal()">&times;</span>
        <h2>Muuda treeningut</h2>
        <form method="POST">
            <input type="hidden" id="edit-workout-id" name="id">

            <!-- Name -->
            <label for="edit-name">Treeningu nimi:</label>
            <input type="text" id="edit-name" name="name" required>

            <!-- Category (Sport) -->
            <label for="edit-sport">Kategooria:</label>
            <select id="edit-sport" name="sport" required>
                <option value="jõutreening">Jõutreening</option>
                <option value="kardio">Kardio</option>
                <option value="jooga">Jooga</option>
                <option value="muu">Muu</option>
            </select>

            <!-- Duration -->
            <label for="edit-duration">Kestus (minutites):</label>
            <input type="number" id="edit-duration" name="duration" required>

            <!-- Mood -->
            <label for="edit-mood">Meeleolu:</label>
            <input type="text" id="edit-mood" name="mood" required>

            <!-- Who Did the Workout -->
            <label for="edit-who-did">Kes tegi?</label>
            <select id="edit-who-did" name="who_did" required>
                <option value="Romet">Romet</option>
                <option value="Eliis">Eliis</option>
                <option value="Both">Mõlemad</option>
            </select>

            <!-- Date -->
            <label for="edit-date">Kuupäev:</label>
            <input type="date" id="edit-date" name="date" required>

            <button type="submit" class="submit-button">Salvesta muudatused</button>
        </form>
    </div>
</div>

<!-- JavaScript for Filter and Edit Modal -->
<script>
    function filterWorkouts() {
        const category = document.getElementById("category-filter").value;
        const rows = document.querySelectorAll("#workout-table .workout-row");

        rows.forEach(row => {
            const rowCategory = row.getAttribute("data-category");
            if (category === "all" || rowCategory === category) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    }

    function openEditWorkoutModal(id, name, sport, duration, mood, who_did, date) {
        document.getElementById('edit-workout-id').value = id;
        document.getElementById('edit-name').value = name;
        document.getElementById('edit-sport').value = sport;
        document.getElementById('edit-duration').value = duration;
        document.getElementById('edit-mood').value = mood;
        document.getElementById('edit-who-did').value = who_did;
        document.getElementById('edit-date').value = date;

        // Set the correct form action dynamically
        document.querySelector("#editWorkoutModal form").action = `/edit_workout/${id}`;

        document.getElementById('editWorkoutModal').style.display = 'block';
    }

    function closeEditWorkoutModal() {
        document.getElementById('editWorkoutModal').style.display = 'none';
    }

    window.onclick = function(event) {
        var modal = document.getElementById('editWorkoutModal');
        if (event.target === modal) {
            closeEditWorkoutModal();
        }
    };
</script>
